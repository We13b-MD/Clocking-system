<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Clocking System</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script type="text/javascript">
        window.tailwind.config = {
            darkMode: ['class'],
            theme: {
                extend: {
                    colors: {
                        border: 'hsl(var(--border))',
                        input: 'hsl(var(--input))',
                        ring: 'hsl(var(--ring))',
                        background: 'hsl(var(--background))',
                        foreground: 'hsl(var(--foreground))',
                        primary: {
                            DEFAULT: 'hsl(var(--primary))',
                            foreground: 'hsl(var(--primary-foreground))'
                        },
                        secondary: {
                            DEFAULT: 'hsl(var(--secondary))',
                            foreground: 'hsl(var(--secondary-foreground))'
                        },
                        destructive: {
                            DEFAULT: 'hsl(var(--destructive))',
                            foreground: 'hsl(var(--destructive-foreground))'
                        },
                        muted: {
                            DEFAULT: 'hsl(var(--muted))',
                            foreground: 'hsl(var(--muted-foreground))'
                        },
                        accent: {
                            DEFAULT: 'hsl(var(--accent))',
                            foreground: 'hsl(var(--accent-foreground))'
                        },
                        popover: {
                            DEFAULT: 'hsl(var(--popover))',
                            foreground: 'hsl(var(--popover-foreground))'
                        },
                        card: {
                            DEFAULT: 'hsl(var(--card))',
                            foreground: 'hsl(var(--card-foreground))'
                        },
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer base {
            :root {
                --background: 0 0% 100%;
                --foreground: 224 71.4% 4.1%;
                --card: 0 0% 100%;
                --card-foreground: 224 71.4% 4.1%;
                --popover: 0 0% 100%;
                --popover-foreground: 224 71.4% 4.1%;
                --primary: 220.9 39.3% 11%;
                --primary-foreground: 210 20% 98%;
                --secondary: 220 14.3% 95.9%;
                --secondary-foreground: 220.9 39.3% 11%;
                --muted: 220 14.3% 95.9%;
                --muted-foreground: 220 8.9% 46.1%;
                --accent: 220 14.3% 95.9%;
                --accent-foreground: 220.9 39.3% 11%;
                --destructive: 0 84.2% 60.2%;
                --destructive-foreground: 210 20% 98%;
                --border: 220 13% 91%;
                --input: 220 13% 91%;
                --ring: 224 71.4% 4.1%;
                --radius: 0.35rem;
            }
            .dark {
                --background: 224 71.4% 4.1%;
                --foreground: 210 20% 98%;
                --card: 224 71.4% 4.1%;
                --card-foreground: 210 20% 98%;
                --popover: 224 71.4% 4.1%;
                --popover-foreground: 210 20% 98%;
                --primary: 210 20% 98%;
                --primary-foreground: 220.9 39.3% 11%;
                --secondary: 215 27.9% 16.9%;
                --secondary-foreground: 210 20% 98%;
                --muted: 215 27.9% 16.9%;
                --muted-foreground: 217.9 10.6% 64.9%;
                --accent: 215 27.9% 16.9%;
                --accent-foreground: 210 20% 98%;
                --destructive: 0 62.8% 30.6%;
                --destructive-foreground: 210 20% 98%;
                --border: 215 27.9% 16.9%;
                --input: 215 27.9% 16.9%;
                --ring: 216 12.2% 83.9%;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar - Hidden on mobile, shown on tablet/desktop -->
        <div class="bg-blue-900 text-white w-full md:w-64 md:flex-shrink-0 md:block hidden" id="sidebar">
            <div class="p-4">
                <h2 class="text-2xl font-bold mb-8">MikiClock</h2>
                <nav>
                    <ul>
                        <li class="mb-2">
                            <a href="#" class="flex items-center p-3 rounded-md bg-blue-800 hover:bg-blue-700">
                                <i class="fas fa-tachometer-alt mr-3"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                       
                        <li class="mb-2">
                            <a href="timehistory.html" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                <i class="fas fa-history mr-3"></i>
                                <span>Time History</span>
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="reports.html" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                <i class="fas fa-chart-bar mr-3"></i>
                                <span>Reports</span>
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="#" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                <i class="fas fa-cog mr-3"></i>
                                <span>Settings</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="mt-auto p-4 border-t border-blue-800">
                <a href="form.html" id="logout-link" class="flex items-center p-2 rounded-md hover:bg-blue-700">
                    <i class="fas fa-sign-out-alt mr-3"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1">
            <!-- Mobile Top Bar -->
            <div class="bg-blue-900 text-white p-4 flex justify-between items-center md:hidden">
                <h2 class="text-xl font-bold">MikiClock</h2>
                <button id="menuToggle" class="text-white focus:outline-none">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <!-- Mobile Sidebar (Hidden by default) -->
            <div class="bg-blue-900 text-white w-full hidden" id="mobileSidebar">
                <div class="p-4">
                    <nav>
                        <ul>
                            <li class="mb-2">
                                <a href="#" class="flex items-center p-3 rounded-md bg-blue-800 hover:bg-blue-700">
                                    <i class="fas fa-tachometer-alt mr-3"></i>
                                    <span>Dashboard</span>
                                </a>
                            </li>
                          
                            <li class="mb-2">
                                <a href="#" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                    <i class="fas fa-history mr-3"></i>
                                    <span>Time History</span>
                                </a>
                            </li>
                            <li class="mb-2">
                                <a href="" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                    <i class="fas fa-chart-bar mr-3"></i>
                                    <span>Reports</span>
                                </a>
                            </li>
                            <li class="mb-2">
                                <a href="#" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                    <i class="fas fa-cog mr-3"></i>
                                    <span>Settings</span>
                                </a>
                            </li>
                            <li class="mb-2">
                                <a href="#" id="logout-link" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                    <i class="fas fa-sign-out-alt mr-3"></i>
                                    <span>Logout</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

            <!-- Content Area -->
            <div class="p-4 md:p-8">
                <!-- Header with Current Time -->
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-gray-800">Dashboard</h1>
                    <div class="text-lg font-semibold" id="currentTime">
                        <span id="currentDate"></span> | <span id="clock"></span>
                    </div>
                </div>

                <!-- User Info Card -->
                <div class="bg-white rounded-lg shadow-md p-4 mb-6 flex flex-col md:flex-row md:items-center">
                    <div class="flex items-center mb-4 md:mb-0">
                        <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center text-blue-800 text-xl font-bold mr-4">
                            DT
                        </div>
                        <div>
                            <h2 class="text-xl font-bold" id="employeeName">John Doe</h2>
                            <p class="text-gray-600" id="employeeId">ID: EMP001</p>
                        </div>
                    </div>
                    <div class="md:ml-auto flex flex-col md:items-end">
                       
                        <p class="text-gray-600"> <span class="font-semibold"></span></p>
                    </div>
                </div>

                <!-- Clock In/Out Card -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4">Clock In/Out</h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="border rounded-lg p-4">
                            <p class="text-gray-600 mb-2">Current Status:</p>
                            <p class="text-lg font-bold" id="clockStatus">
                                <span class="text-gray-500">
                                    <i class="fas fa-circle text-xs mr-2"></i>Not Clocked In
                                </span>
                            </p>
                        </div>
                        <div class="border rounded-lg p-4">
                            <p class="text-gray-600 mb-2">Today's Hours:</p>
                            <p class="text-lg font-bold" id="todayHours">
                                <span id="hoursWorked">--</span>
                            </p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="border rounded-lg p-4">
                            <p class="text-gray-600 mb-2">Clock In Time:</p>
                            <p class="text-lg font-bold" id="clockInTime">--:-- --</p>
                        </div>
                        <div class="border rounded-lg p-4">
                            <p class="text-gray-600 mb-2">Clock Out Time:</p>
                            <p class="text-lg font-bold" id="clockOutTime">--:-- --</p>
                        </div>
                    </div>

                    <div class="flex flex-col md:flex-row gap-4">
                        <button id="clockInBtn" class="bg-blue-900 text-white py-3 px-6 rounded-lg hover:bg-blue-800 transition duration-300 flex-1 flex items-center justify-center">
                            <i class="fas fa-sign-in-alt mr-2"></i> Clock In
                        </button>
                        <button id="clockOutBtn" class="bg-red-600 text-white py-3 px-6 rounded-lg hover:bg-red-700 transition duration-300 flex-1 flex items-center justify-center" disabled>
                            <i class="fas fa-sign-out-alt mr-2"></i> Clock Out
                        </button>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold mb-4">Recent Activity</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr class="bg-gray-100 text-gray-600 text-left">
                                    <th class="py-3 px-4 font-semibold">Date</th>
                                    <th class="py-3 px-4 font-semibold">Clock In</th>
                                    <th class="py-3 px-4 font-semibold">Clock Out</th>
                                    <th class="py-3 px-4 font-semibold">Total Hours</th>
                                    <th class="py-3 px-4 font-semibold">Status</th>
                                </tr>
                            </thead>
                            <tbody id="activityTableBody">
                                <!-- Activity records will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Mobile menu toggle script -->
    <script>
        /*document.getElementById('menuToggle').addEventListener('click', function() {
            const mobileSidebar = document.getElementById('mobileSidebar');
            mobileSidebar.classList.toggle('hidden');
        });
    
        // Display current time and date
        function updateClock() {
            const now = new Date();
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
                    
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', dateOptions);
            document.getElementById('clock').textContent = now.toLocaleTimeString('en-US', timeOptions);
        }
    
        // Update clock every second
        updateClock();
        setInterval(updateClock, 1000);
    </script>
    
    <!-- Clock System Functionality -->
    <script>
   /* document.addEventListener('DOMContentLoaded', function() {
        // Retrieve the logged in user from session storage (from login system)
        const loggedInUser = sessionStorage.getItem('loggedInUser');
    const userRole = sessionStorage.getItem('userRole');
    
    if (!loggedInUser) {
        // If not logged in, redirect to login page
        window.location.href = 'form.html';
        return;
    }
    
    const userData = {
        name: loggedInUser, // Use the actual logged-in username
        id: "EMP001",
        department: userRole || "Not Specified", // Use the user's role as department
        position: userRole || "Employee" // Also use role as position
    };

    // Update UI with user data
    document.getElementById('employeeName').textContent = userData.name;
    document.getElementById('employeeId').textContent = "ID: " + userData.id;
    
    // If you have elements to display department/role
    if (document.getElementById('employeeDepartment')) {
        document.getElementById('employeeDepartment').textContent = userData.department;
    }
    if (document.getElementById('employeePosition')) {
        document.getElementById('employeePosition').textContent = userData.position;
    }
        // Get all clock records from localStorage
        function getClockRecords() {
            return JSON.parse(localStorage.getItem('clockRecords')) || [];
        }

        // Save clock records to localStorage
        function saveClockRecords(records) {
            localStorage.setItem('clockRecords', JSON.stringify(records));
        }

        // Get today's record for current user
        function getTodayRecord() {
            const records = getClockRecords();
            const today = new Date().toLocaleDateString('en-US');
            return records.find(record => 
                record.employeeId === userData.id && 
                new Date(record.date).toLocaleDateString('en-US') === today
            );
        }

        // Format time for display (12-hour format)
        function formatTime(date) {
            if (!date) return '--:-- --';
            
            const hours = date.getHours();
            const minutes = date.getMinutes();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const formattedHours = hours % 12 || 12;
            const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
            
            return `${formattedHours}:${formattedMinutes} ${ampm}`;
        }

        // Calculate duration between two times
        function calculateDuration(startTime, endTime) {
            if (!startTime || !endTime) return '--';
            
            const start = new Date(startTime);
            const end = new Date(endTime);
            const diffMs = end - start;
            
            const hours = Math.floor(diffMs / (1000 * 60 * 60));
            const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
            
            return `${hours}h ${minutes}m`;
        }

        // Update the clock status UI
        function updateClockStatus() {
            const todayRecord = getTodayRecord();
            
            if (!todayRecord) {
                // No record for today
                clockStatus.innerHTML = '<span class="text-gray-500"><i class="fas fa-circle text-xs mr-2"></i>Not Clocked In</span>';
                clockInTime.textContent = '--:-- --';
                clockOutTime.textContent = '--:-- --';
                hoursWorked.textContent = '--';
                
                clockInBtn.disabled = false;
                clockOutBtn.disabled = true;
                
                return;
            }
            
            const clockInDateTime = new Date(todayRecord.clockIn);
            clockInTime.textContent = formatTime(clockInDateTime);
            
            if (todayRecord.clockOut) {
                // Already clocked out
                const clockOutDateTime = new Date(todayRecord.clockOut);
                clockStatus.innerHTML = '<span class="text-gray-500"><i class="fas fa-circle text-xs mr-2"></i>Clocked Out</span>';
                clockOutTime.textContent = formatTime(clockOutDateTime);
                hoursWorked.textContent = calculateDuration(todayRecord.clockIn, todayRecord.clockOut);
                
                clockInBtn.disabled = true;
                clockOutBtn.disabled = true;
            } else {
                // Currently clocked in
                clockStatus.innerHTML = '<span class="text-green-500"><i class="fas fa-circle text-xs mr-2"></i>Clocked In</span>';
                clockOutTime.textContent = '--:-- --';
                
                // Calculate hours worked so far
                const currentTime = new Date();
                hoursWorked.textContent = calculateDuration(todayRecord.clockIn, currentTime);
                
                // Update hours worked continuously
                setInterval(() => {
                    const now = new Date();
                    hoursWorked.textContent = calculateDuration(todayRecord.clockIn, now);
                }, 60000); // Update every minute
                
                clockInBtn.disabled = true;
                clockOutBtn.disabled = false;
            }
        }

        // Populate recent activity table
        function populateActivityTable() {
            const records = getClockRecords().filter(record => record.employeeId === userData.id);
            // Sort records by date (newest first)
            records.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Clear existing rows except header
            activityTableBody.innerHTML = '';
            
            // Add records to table (show up to 5 most recent)
            const recordsToShow = records.slice(0, 5);
            
            recordsToShow.forEach(record => {
                const row = document.createElement('tr');
                row.className = 'border-b';
                
                // Format date for display
                const recordDate = new Date(record.date);
                const dateFormatted = recordDate.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
                
                const clockInTime = formatTime(new Date(record.clockIn));
                const clockOutTime = record.clockOut ? formatTime(new Date(record.clockOut)) : '--:-- --';
                const totalHours = record.clockOut ? 
                    calculateDuration(record.clockIn, record.clockOut) : 
                    'In Progress';
                
                const status = record.clockOut ? 
                    '<span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Complete</span>' : 
                    '<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">In Progress</span>';
                
                row.innerHTML = `
                    <td class="py-3 px-4">${dateFormatted}</td>
                    <td class="py-3 px-4">${clockInTime}</td>
                    <td class="py-3 px-4">${clockOutTime}</td>
                    <td class="py-3 px-4">${totalHours}</td>
                    <td class="py-3 px-4">${status}</td>
                `;
                
                activityTableBody.appendChild(row);
            });
            
            // If no records, show a message
            if (records.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" class="py-4 px-4 text-center text-gray-500">No clock records found</td>
                `;
                activityTableBody.appendChild(row);
            }
        }

        // Clock In function
        function clockIn() {
            const now = new Date();
            const today = now.toLocaleDateString('en-US');
            
            // Check if already clocked in today
            const todayRecord = getTodayRecord();
            
            if (todayRecord) {
                Swal.fire({
                    title: 'Already Clocked In',
                    text: 'You have already clocked in today!',
                    icon: 'warning',
                    confirmButtonColor: '#1e40af'
                });
                return;
            }
            
            // Create new clock record
            const newRecord = {
                id: Date.now().toString(),
                employeeId: userData.id,
                date: now.toISOString().split('T')[0],
                clockIn: now.toISOString(),
                clockOut: null,
                location: 'Office', // Could be dynamic based on geolocation
                ipAddress: '192.168.1.1' // Could be captured from client if needed
            };
            
            // Add to records
            const records = getClockRecords();
            records.push(newRecord);
            saveClockRecords(records);
            
            // Update UI
            updateClockStatus();
            populateActivityTable();
            
            // Show success message
            Swal.fire({
                title: 'Clocked In!',
                text: `Successfully clocked in at ${formatTime(now)}`,
                icon: 'success',
                confirmButtonColor: '#1e40af'
            });
        }

        // Clock Out function
        function clockOut() {
            const now = new Date();
            
            // Get today's record
            const records = getClockRecords();
            const todayRecord = getTodayRecord();
            
            if (!todayRecord) {
                Swal.fire({
                    title: 'Not Clocked In',
                    text: 'You need to clock in first!',
                    icon: 'warning',
                    confirmButtonColor: '#1e40af'
                });
                return;
            }
            
            if (todayRecord.clockOut) {
                Swal.fire({
                    title: 'Already Clocked Out',
                    text: 'You have already clocked out today!',
                    icon: 'warning',
                    confirmButtonColor: '#1e40af'
                });
                return;
            }
            
            // Update the record with clock out time
            const recordIndex = records.findIndex(r => r.id === todayRecord.id);
            records[recordIndex].clockOut = now.toISOString();
            saveClockRecords(records);
            
            // Update UI
            updateClockStatus();
            populateActivityTable();
            
            // Calculate hours worked
            const hoursWorked = calculateDuration(todayRecord.clockIn, now);
            
            // Show success message
            Swal.fire({
                title: 'Clocked Out!',
                text: `Successfully clocked out at ${formatTime(now)}. Total hours worked: ${hoursWorked}`,
                icon: 'success',
                confirmButtonColor: '#1e40af'
            });
        }

        // Event listeners for clock buttons
        clockInBtn.addEventListener('click', clockIn);
        clockOutBtn.addEventListener('click', clockOut);

        // Initialize the UI
        updateClockStatus();
        populateActivityTable();
    });*/


    /*document.addEventListener('DOMContentLoaded', function() {
    const loggedInUser = sessionStorage.getItem('loggedInUser');
    const userRole = sessionStorage.getItem('userRole');
    
    // Declare userData in the global scope of this function so it can be used by all functions
    let userData = {
        name: "",
        id: "",
        department: "",
        position: ""
    };
    
    if (!loggedInUser) {
        // If not logged in, redirect to login page
        window.location.href = 'form.html';
        return;
    }
    
    // Get all users from localStorage to find the current user's full data
    const users = JSON.parse(localStorage.getItem('users')) || [];
    const currentUser = users.find(user => user.name === loggedInUser);
    
    if (currentUser) {
        // Update userData object with current user's data
        userData = {
            name: currentUser.name,
            id: currentUser.employeeId,
            department: currentUser.role || "Not Specified",
            position: currentUser.role || "Employee"
        };
        
        // Update basic user info
        document.getElementById('employeeName').textContent = currentUser.name;
        document.getElementById('employeeId').textContent = "ID: " + currentUser.employeeId;
        
        // Update department and position by directly modifying the HTML content
        const departmentText = "Department: <span class=\"font-semibold\">" + 
                              (currentUser.role || "Not Specified") + "</span>";
        
        const positionText = "Position: <span class=\"font-semibold\">" + 
                            (currentUser.role || "Employee") + "</span>";
        
        // Find the department and position paragraphs and update them
        const paragraphs = document.querySelectorAll('p.text-gray-600');
        if (paragraphs.length >= 2) {
            paragraphs[0].innerHTML = departmentText;
            paragraphs[1].innerHTML = positionText;
        }
    } else {
        console.error("User data not found!");
        // Set default userData if current user not found
        userData = {
            name: loggedInUser,
            id: "EMP001",
            department: userRole || "Not Specified",
            position: userRole || "Employee"
        };
    }

    // Get all clock records from localStorage
    function getClockRecords() {
        return JSON.parse(localStorage.getItem('clockRecords')) || [];
    }

    // Save clock records to localStorage
    function saveClockRecords(records) {
        localStorage.setItem('clockRecords', JSON.stringify(records));
    }

    // Get today's record for current user
    function getTodayRecord() {
        const records = getClockRecords();
        const today = new Date().toLocaleDateString('en-US');
        return records.find(record => 
            record.employeeId === userData.id && 
            new Date(record.date).toLocaleDateString('en-US') === today
        );
    }

    // Format time for display (12-hour format)
    function formatTime(date) {
        if (!date) return '--:-- --';
        
        const hours = date.getHours();
        const minutes = date.getMinutes();
        const ampm = hours >= 12 ? 'PM' : 'AM';
        const formattedHours = hours % 12 || 12;
        const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
        
        return `${formattedHours}:${formattedMinutes} ${ampm}`;
    }

    // Calculate duration between two times
    function calculateDuration(startTime, endTime) {
        if (!startTime || !endTime) return '--';
        
        const start = new Date(startTime);
        const end = new Date(endTime);
        const diffMs = end - start;
        
        const hours = Math.floor(diffMs / (1000 * 60 * 60));
        const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
        
        return `${hours}h ${minutes}m`;
    }

    // Update the clock status UI
    function updateClockStatus() {
        const todayRecord = getTodayRecord();
        
        if (!todayRecord) {
            // No record for today
            clockStatus.innerHTML = '<span class="text-gray-500"><i class="fas fa-circle text-xs mr-2"></i>Not Clocked In</span>';
            clockInTime.textContent = '--:-- --';
            clockOutTime.textContent = '--:-- --';
            hoursWorked.textContent = '--';
            
            clockInBtn.disabled = false;
            clockOutBtn.disabled = true;
            
            return;
        }
        
        const clockInDateTime = new Date(todayRecord.clockIn);
        clockInTime.textContent = formatTime(clockInDateTime);
        
        if (todayRecord.clockOut) {
            // Already clocked out
            const clockOutDateTime = new Date(todayRecord.clockOut);
            clockStatus.innerHTML = '<span class="text-gray-500"><i class="fas fa-circle text-xs mr-2"></i>Clocked Out</span>';
            clockOutTime.textContent = formatTime(clockOutDateTime);
            hoursWorked.textContent = calculateDuration(todayRecord.clockIn, todayRecord.clockOut);
            
            clockInBtn.disabled = true;
            clockOutBtn.disabled = true;
        } else {
            // Currently clocked in
            clockStatus.innerHTML = '<span class="text-green-500"><i class="fas fa-circle text-xs mr-2"></i>Clocked In</span>';
            clockOutTime.textContent = '--:-- --';
            
            // Calculate hours worked so far
            const currentTime = new Date();
            hoursWorked.textContent = calculateDuration(todayRecord.clockIn, currentTime);
            
            // Update hours worked continuously
            setInterval(() => {
                const now = new Date();
                hoursWorked.textContent = calculateDuration(todayRecord.clockIn, now);
            }, 60000); // Update every minute
            
            clockInBtn.disabled = true;
            clockOutBtn.disabled = false;
        }
    }

    // Populate recent activity table
    function populateActivityTable() {
        const records = getClockRecords().filter(record => record.employeeId === userData.id);
        // Sort records by date (newest first)
        records.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        // Clear existing rows except header
        activityTableBody.innerHTML = '';
        
        // Add records to table (show up to 5 most recent)
        const recordsToShow = records.slice(0, 5);
        
        recordsToShow.forEach(record => {
            const row = document.createElement('tr');
            row.className = 'border-b';
            
            // Format date for display
            const recordDate = new Date(record.date);
            const dateFormatted = recordDate.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
            
            const clockInTime = formatTime(new Date(record.clockIn));
            const clockOutTime = record.clockOut ? formatTime(new Date(record.clockOut)) : '--:-- --';
            const totalHours = record.clockOut ? 
                calculateDuration(record.clockIn, record.clockOut) : 
                'In Progress';
            
            const status = record.clockOut ? 
                '<span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Complete</span>' : 
                '<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">In Progress</span>';
            
            row.innerHTML = `
                <td class="py-3 px-4">${dateFormatted}</td>
                <td class="py-3 px-4">${clockInTime}</td>
                <td class="py-3 px-4">${clockOutTime}</td>
                <td class="py-3 px-4">${totalHours}</td>
                <td class="py-3 px-4">${status}</td>
            `;
            
            activityTableBody.appendChild(row);
        });
        
        // If no records, show a message
        if (records.length === 0) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td colspan="5" class="py-4 px-4 text-center text-gray-500">No clock records found</td>
            `;
            activityTableBody.appendChild(row);
        }
    }

    // Clock In function
    function clockIn() {
        const now = new Date();
        const today = now.toLocaleDateString('en-US');
        
        // Check if already clocked in today
        const todayRecord = getTodayRecord();
        
        if (todayRecord) {
            Swal.fire({
                title: 'Already Clocked In',
                text: 'You have already clocked in today!',
                icon: 'warning',
                confirmButtonColor: '#1e40af'
            });
            return;
        }
        
        // Create new clock record
        const newRecord = {
            id: Date.now().toString(),
            employeeId: userData.id,
            date: now.toISOString().split('T')[0],
            clockIn: now.toISOString(),
            clockOut: null,
            location: 'Office', // Could be dynamic based on geolocation
            ipAddress: '192.168.1.1' // Could be captured from client if needed
        };
        
        // Add to records
        const records = getClockRecords();
        records.push(newRecord);
        saveClockRecords(records);
        
        // Update UI
        updateClockStatus();
        populateActivityTable();
        
        // Show success message
        Swal.fire({
            title: 'Clocked In!',
            text: `Successfully clocked in at ${formatTime(now)}`,
            icon: 'success',
            confirmButtonColor: '#1e40af'
        });
    }

    // Clock Out function
    function clockOut() {
        const now = new Date();
        
        // Get today's record
        const records = getClockRecords();
        const todayRecord = getTodayRecord();
        
        if (!todayRecord) {
            Swal.fire({
                title: 'Not Clocked In',
                text: 'You need to clock in first!',
                icon: 'warning',
                confirmButtonColor: '#1e40af'
            });
            return;
        }
        
        if (todayRecord.clockOut) {
            Swal.fire({
                title: 'Already Clocked Out',
                text: 'You have already clocked out today!',
                icon: 'warning',
                confirmButtonColor: '#1e40af'
            });
            return;
        }
        
        // Update the record with clock out time
        const recordIndex = records.findIndex(r => r.id === todayRecord.id);
        records[recordIndex].clockOut = now.toISOString();
        saveClockRecords(records);
        
        // Update UI
        updateClockStatus();
        populateActivityTable();
        
        // Calculate hours worked
        const hoursWorked = calculateDuration(todayRecord.clockIn, now);
        
        // Show success message
        Swal.fire({
            title: 'Clocked Out!',
            text: `Successfully clocked out at ${formatTime(now)}. Total hours worked: ${hoursWorked}`,
            icon: 'success',
            confirmButtonColor: '#1e40af'
        });
    }

    // Event listeners for clock buttons
    clockInBtn.addEventListener('click', clockIn);
    clockOutBtn.addEventListener('click', clockOut);

    // Initialize the UI
    updateClockStatus();
    populateActivityTable();
});

//logout functionality

// Logout function
document.addEventListener('DOMContentLoaded', function() {
        const logoutLink = document.getElementById('logout-link');
        
        if (logoutLink) {
            logoutLink.addEventListener('click', function(event) {
                // Prevent the default link behavior
                event.preventDefault();
                
                try {
                    // Clear user data from session storage
                    sessionStorage.removeItem('loggedInUser');
                    sessionStorage.removeItem('userPassword');
                    
                    // Simple alert (no SweetAlert dependency)
                    alert("You have been logged out successfully.");
                    
                    // Redirect to login page
                    window.location.href = 'form.html';
                } catch (error) {
                    console.error("Error during logout:", error);
                    alert("Error during logout. Please try again.");
                }
            });
        } else {
            console.error("Logout link not found!");
        }
    });*/


    document.addEventListener('DOMContentLoaded', function() {
    const loggedInUser = sessionStorage.getItem('loggedInUser');
    const userRole = sessionStorage.getItem('userRole');
    
    // Declare userData in the global scope of this function so it can be used by all functions
    let userData = {
        name: "",
        id: "",
        department: "",
        position: ""
    };
    
    if (!loggedInUser) {
        // If not logged in, redirect to login page
        window.location.href = 'form.html';
        return;
    }
    
    // Get all users from localStorage to find the current user's full data
    const users = JSON.parse(localStorage.getItem('users')) || [];
    const currentUser = users.find(user => user.name === loggedInUser);
    
    if (currentUser) {
        // Update userData object with current user's data
        userData = {
            name: currentUser.name,
            id: currentUser.employeeId,
            department: currentUser.role || "Not Specified",
            position: currentUser.role || "Employee"
        };
        
        // Update basic user info
        document.getElementById('employeeName').textContent = currentUser.name;
        document.getElementById('employeeId').textContent = "ID: " + currentUser.employeeId;
        
        // Update department and position by directly modifying the HTML content
        const departmentText = "<span class=\"font-semibold\"> Position: " + 
                              (currentUser.role || "Not Specified") + "</span>";
        
        
        
        // Find the department and position paragraphs and update them
        const paragraphs = document.querySelectorAll('p.text-gray-600');
        if (paragraphs.length >= 2) {
            paragraphs[0].innerHTML = departmentText;
            //paragraphs[1].innerHTML = positionText;
        }
    } else {
        console.error("User data not found!");
        // Set default userData if current user not found
        userData = {
            name: loggedInUser,
            id: "EMP001",
            department: userRole || "Not Specified",
            position: userRole || "Employee"
        };
    }

    // Get all clock records from localStorage
    function getClockRecords() {
        return JSON.parse(localStorage.getItem('clockRecords')) || [];
    }

    // Save clock records to localStorage
    function saveClockRecords(records) {
        localStorage.setItem('clockRecords', JSON.stringify(records));
    }

    // Get today's active record for current user (the one without clockOut)
    function getActiveClockSession() {
        const records = getClockRecords();
        const today = new Date().toLocaleDateString('en-US');
        
        // Find the most recent record for today that doesn't have a clockOut time
        return records.find(record => 
            record.employeeId === userData.id && 
            new Date(record.date).toLocaleDateString('en-US') === today &&
            !record.clockOut
        );
    }

    // Format time for display (12-hour format)
    function formatTime(date) {
        if (!date) return '--:-- --';
        
        const hours = date.getHours();
        const minutes = date.getMinutes();
        const ampm = hours >= 12 ? 'PM' : 'AM';
        const formattedHours = hours % 12 || 12;
        const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
        
        return `${formattedHours}:${formattedMinutes} ${ampm}`;
    }

    // Calculate duration between two times
    function calculateDuration(startTime, endTime) {
        if (!startTime || !endTime) return '--';
        
        const start = new Date(startTime);
        const end = new Date(endTime);
        const diffMs = end - start;
        
        const hours = Math.floor(diffMs / (1000 * 60 * 60));
        const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
        
        return `${hours}h ${minutes}m`;
    }

    // Update the clock status UI
    function updateClockStatus() {
        const activeSession = getActiveClockSession();
        
        if (!activeSession) {
            // No active session - user is clocked out
            clockStatus.innerHTML = '<span class="text-gray-500"><i class="fas fa-circle text-xs mr-2"></i>Not Clocked In</span>';
            clockInTime.textContent = '--:-- --';
            clockOutTime.textContent = '--:-- --';
            hoursWorked.textContent = '--';
            
            clockInBtn.disabled = false;
            clockOutBtn.disabled = true;
            
            return;
        }
        
        // User is clocked in
        const clockInDateTime = new Date(activeSession.clockIn);
        clockStatus.innerHTML = '<span class="text-green-500"><i class="fas fa-circle text-xs mr-2"></i>Clocked In</span>';
        clockInTime.textContent = formatTime(clockInDateTime);
        clockOutTime.textContent = '--:-- --';
        
        // Calculate hours worked so far
        const currentTime = new Date();
        hoursWorked.textContent = calculateDuration(activeSession.clockIn, currentTime);
        
        // Update hours worked continuously
        const hoursUpdateInterval = setInterval(() => {
            const now = new Date();
            // Check if we're still clocked in
            if (getActiveClockSession()) {
                hoursWorked.textContent = calculateDuration(activeSession.clockIn, now);
            } else {
                clearInterval(hoursUpdateInterval);
            }
        }, 60000); // Update every minute
        
        clockInBtn.disabled = true;
        clockOutBtn.disabled = false;
    }

    // Populate recent activity table
    function populateActivityTable() {
        const records = getClockRecords().filter(record => record.employeeId === userData.id);
        // Sort records by date (newest first)
        records.sort((a, b) => new Date(b.clockIn) - new Date(a.clockIn));
        
        // Clear existing rows except header
        activityTableBody.innerHTML = '';
        
        // Add records to table (show up to 5 most recent)
        const recordsToShow = records.slice(0, 5);
        
        recordsToShow.forEach(record => {
            const row = document.createElement('tr');
            row.className = 'border-b';
            
            // Format date for display
            const recordDate = new Date(record.date);
            const dateFormatted = recordDate.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
            
            const clockInTime = formatTime(new Date(record.clockIn));
            const clockOutTime = record.clockOut ? formatTime(new Date(record.clockOut)) : '--:-- --';
            const totalHours = record.clockOut ? 
                calculateDuration(record.clockIn, record.clockOut) : 
                'In Progress';
            
            const status = record.clockOut ? 
                '<span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Complete</span>' : 
                '<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">In Progress</span>';
            
            row.innerHTML = `
                <td class="py-3 px-4">${dateFormatted}</td>
                <td class="py-3 px-4">${clockInTime}</td>
                <td class="py-3 px-4">${clockOutTime}</td>
                <td class="py-3 px-4">${totalHours}</td>
                <td class="py-3 px-4">${status}</td>
            `;
            
            activityTableBody.appendChild(row);
        });
        
        // If no records, show a message
        if (records.length === 0) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td colspan="5" class="py-4 px-4 text-center text-gray-500">No clock records found</td>
            `;
            activityTableBody.appendChild(row);
        }
    }

    // Clock In function
    function clockIn() {
        const now = new Date();
        
        // Check if already clocked in (has an active session)
        const activeSession = getActiveClockSession();
        
        if (activeSession) {
            Swal.fire({
                title: 'Already Clocked In',
                text: 'You are currently clocked in. Please clock out first.',
                icon: 'warning',
                confirmButtonColor: '#1e40af'
            });
            return;
        }
        
        // Create new clock record
        const newRecord = {
            id: Date.now().toString(),
            employeeId: userData.id,
            date: now.toISOString().split('T')[0],
            clockIn: now.toISOString(),
            clockOut: null,
            location: 'Office', // Could be dynamic based on geolocation
            ipAddress: '192.168.1.1' // Could be captured from client if needed
        };
        
        // Add to records
        const records = getClockRecords();
        records.push(newRecord);
        saveClockRecords(records);
        
        // Update UI
        updateClockStatus();
        populateActivityTable();
        
        // Show success message
        Swal.fire({
            title: 'Clocked In!',
            text: `Successfully clocked in at ${formatTime(now)}`,
            icon: 'success',
            confirmButtonColor: '#1e40af'
        });
    }

    // Clock Out function
    function clockOut() {
        const now = new Date();
        
        // Get active session
        const records = getClockRecords();
        const activeSession = getActiveClockSession();
        
        if (!activeSession) {
            Swal.fire({
                title: 'Not Clocked In',
                text: 'You need to clock in first!',
                icon: 'warning',
                confirmButtonColor: '#1e40af'
            });
            return;
        }
        
        // Update the record with clock out time
        const recordIndex = records.findIndex(r => r.id === activeSession.id);
        records[recordIndex].clockOut = now.toISOString();
        saveClockRecords(records);
        
        // Update UI
        updateClockStatus();
        populateActivityTable();
        
        // Calculate hours worked
        const hoursWorked = calculateDuration(activeSession.clockIn, now);
        
        // Show success message
        Swal.fire({
            title: 'Clocked Out!',
            text: `Successfully clocked out at ${formatTime(now)}. Total hours worked: ${hoursWorked}`,
            icon: 'success',
            confirmButtonColor: '#1e40af'
        });
    }

    // Add a logout function
    function logoutUser(event) {
        if (event) {
            event.preventDefault();
        }
        
        // Check if user is clocked in
        const activeSession = getActiveClockSession();
        if (activeSession) {
            // Ask if user wants to clock out before logging out
            Swal.fire({
                title: 'Still Clocked In',
                text: 'You are still clocked in. Would you like to clock out before logging out?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Clock Out & Logout',
                cancelButtonText: 'Just Logout',
                confirmButtonColor: '#1e40af',
                cancelButtonColor: '#6b7280'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Clock out first, then logout
                    const now = new Date();
                    const records = getClockRecords();
                    const recordIndex = records.findIndex(r => r.id === activeSession.id);
                    records[recordIndex].clockOut = now.toISOString();
                    saveClockRecords(records);
                    
                    // Now logout
                    performLogout();
                } else {
                    // Just logout without clocking out
                    performLogout();
                }
            });
        } else {
            // Not clocked in, so just logout
            performLogout();
        }
    }
    
    // Helper function to perform the actual logout
    function performLogout() {
        // Clear user data from session storage
        sessionStorage.removeItem('loggedInUser');
        sessionStorage.removeItem('userPassword');
        sessionStorage.removeItem('userRole');
        
        // Show logout success message
        Swal.fire({
            title: 'Logged Out',
            text: 'You have been successfully logged out.',
            icon: 'success',
            confirmButtonColor: '#1e40af'
        }).then(() => {
            // Redirect to login page
            window.location.href = 'form.html';
        });
    }

    // Event listeners for clock buttons
    clockInBtn.addEventListener('click', clockIn);
    clockOutBtn.addEventListener('click', clockOut);
    
    // Add logout event listener
    const logoutLink = document.getElementById('logout-link');
    if (logoutLink) {
        logoutLink.addEventListener('click', logoutUser);
    }

    // Initialize the UI
    updateClockStatus();
    populateActivityTable();
});
    </script>
</body>
</html>